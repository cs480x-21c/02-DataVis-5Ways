<!DOCTYPE html>
<html>
    <body>
        <svg id="svg"></svg>
    </body>
</html>

<script src="https://d3js.org/d3.v6.min.js"></script>

<script>
    console.log(d3);
    let visWidth = 670;
    let visHeight = 510;

    async function initVis() {

        let data = await d3.csv('../cars-sample.csv');
        let svg = d3.select('#svg');
        svg.style('height', visHeight);
        svg.style('width', visWidth);
        //svg.style('border', '1px solid black');

        data = data.filter(d => d.Weight != 'NA' && d.MPG != 'NA');

        let weights = data.map(d => parseInt(d.Weight));
        let mpgs = data.map(d => parseInt(d.MPG));

        let maxWeight = Math.max(...weights);
        let maxMPG = Math.max(...mpgs);

        console.log('max weight: ' + maxWeight);

        let xScale = d3.scaleLinear()
        .domain([1500, maxWeight + 100])
        .range([0, visWidth-100]);

        let yScale = d3.scaleLinear()
        .domain([maxMPG + 5, 8])
        .range([0, visHeight-100]);

        let xAxis = d3.axisBottom().scale(xScale).tickSizeOuter(0)
        .tickValues([2000,3000,4000,5000]);
        let yAxis = d3.axisLeft().scale(yScale).tickSizeOuter(0);

        svg.append('rect')
        .attr('x', '50')
        .attr('y', '20')
        .style('width', '570')
        .style('height', '410')
        .attr('fill', '#ededed');

        let xAxisGroup = svg.append('g')
        .call(xAxis)
        .attr('transform', 'translate(50, 430)');

        let yAxisGroup = svg.append('g').call(yAxis)
        .attr('transform', 'translate(50, 20)');

        xAxisGroup.append('text')
        .text('Weight')
        .attr('x', '310')
        .attr('y', '50')
        .attr('fill', 'black')
        .attr('class', 'label');

        yAxisGroup.append('text')
        .text('MPG')
        .attr('x', '0')
        .attr('y', '0')
        .attr('fill', 'black')
        .attr('transform', 'translate(-40, 190) rotate(-90)')
        .attr('class', 'label');

        svg.selectAll('dot')
        .data(data)
        .enter()
        .append('circle')
            .attr('cx', function(d) { return xScale(d.Weight) + 50 })
            .attr('cy', function(d) { return yScale(d.MPG) + 20 })
            .attr('r', function(d) { 
                return (d.Weight / 1000) * 2;
            })
            .attr('fill', function(d) {

                switch(d.Manufacturer) {

                    case 'ford':
                        return 'yellow';
                        break;
                    
                    case 'toyota':
                        return 'pink';
                        break;
                    
                    case 'bmw':
                        return 'red';
                        break;
                    
                    case 'mercedes':
                        return 'blue';
                        break;
                    
                    case 'honda':
                        return 'green';
                        break;

                }

            })
            .attr('opacity', '0.5')
            .attr('class', 'highlightable')

    }

    initVis();

</script>

<style>
    svg .label {
        font-size: 14px;
    }
    .highlightable {
        opacity: 0.5;
    }
    .highlightable:hover {
        opacity: 1.0;
    }
</style>
